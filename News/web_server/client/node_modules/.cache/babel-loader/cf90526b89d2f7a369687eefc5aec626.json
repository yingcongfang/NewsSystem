{"ast":null,"code":"var _jsxFileName = \"/Users/litianlun/Projects/News/web_server/client/src/NewsPanel/NewsPanel.js\";\nimport \"./NewsPanel.css\";\nimport React from 'react';\nimport NewsCard from '../NewsCard/NewsCard';\nimport Auth from '../Auth/Auth';\nimport _ from 'lodash';\n\nclass NewsPanel extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      news: null,\n      pageNum: 1,\n      totalPages: 1,\n      loadedAll: false\n    };\n    this.handleScroll = this.handleScroll.bind(this);\n  }\n\n  componentDidMount() {\n    this.loadMoreNews();\n    this.loadMoreNews = _.debounce(this.loadMoreNews, 1000);\n    window.addEventListener('scroll', this.handleScroll);\n  }\n\n  handleScroll() {\n    let scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;\n\n    if (window.innerHeight + scrollY >= document.body.offsetHeight - 50) {\n      console.log('Loading more news');\n      this.loadMoreNews();\n    }\n  }\n\n  loadMoreNews(e) {\n    if (this.state.loadedAll === true) {\n      return;\n    }\n\n    let url = 'http://localhost:3000/news/userId/' + Auth.getEmail() + '/pageNum/' + this.state.pageNum;\n    let request = new Request(encodeURI(url), {\n      method: 'GET',\n      headers: {\n        'Authorization': 'bearer ' + Auth.getToken()\n      },\n      cache: 'no-cache'\n    });\n    console.log(request);\n    fetch(request).then(res => res.json()).then(news => {\n      if (!news || news.length === 0) {\n        this.setState({\n          loadedAll: true\n        });\n      }\n\n      this.setState({\n        news: this.state.news ? this.state.news.concat(news) : news // pageNum: this.state.pageNum + 1\n\n      });\n    });\n  }\n\n  renderNews() {\n    let news_list = this.state.news.map(news => {\n      return React.createElement(\"a\", {\n        className: \"list-group-item\",\n        key: news.digest,\n        href: \"#\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63\n        },\n        __self: this\n      }, React.createElement(NewsCard, {\n        news: news,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64\n        },\n        __self: this\n      }));\n    });\n    return React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"list-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71\n      },\n      __self: this\n    }, news_list));\n  }\n\n  render() {\n    if (Auth.isUserAuthenticated()) {\n      if (this.state.news) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82\n          },\n          __self: this\n        }, this.renderNews());\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 91\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"progress\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"indeterminate\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 93\n          },\n          __self: this\n        })));\n      }\n    } else {\n      return React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, \"please login first\");\n    }\n  }\n\n}\n\nexport default NewsPanel;","map":{"version":3,"sources":["/Users/litianlun/Projects/News/web_server/client/src/NewsPanel/NewsPanel.js"],"names":["React","NewsCard","Auth","_","NewsPanel","Component","constructor","state","news","pageNum","totalPages","loadedAll","handleScroll","bind","componentDidMount","loadMoreNews","debounce","window","addEventListener","scrollY","pageYOffset","document","documentElement","scrollTop","innerHeight","body","offsetHeight","console","log","e","url","getEmail","request","Request","encodeURI","method","headers","getToken","cache","fetch","then","res","json","length","setState","concat","renderNews","news_list","map","digest","render","isUserAuthenticated"],"mappings":"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","sourcesContent":["import \"./NewsPanel.css\";\nimport React from 'react';\nimport NewsCard from '../NewsCard/NewsCard';\nimport Auth from '../Auth/Auth';\nimport _ from 'lodash';\n\nclass NewsPanel extends React.Component {\n    constructor() {\n        super();\n        this.state = {\n            news: null,\n            pageNum: 1,\n            totalPages: 1,\n            loadedAll: false\n        };\n        this.handleScroll = this.handleScroll.bind(this);\n    }\n\n    componentDidMount() {\n        this.loadMoreNews();\n        this.loadMoreNews = _.debounce(this.loadMoreNews, 1000);\n        window.addEventListener('scroll', this.handleScroll);\n    }\n\n    handleScroll() {\n        let scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;\n        if ((window.innerHeight + scrollY) >= (document.body.offsetHeight - 50)) {\n            console.log('Loading more news');\n            this.loadMoreNews();\n        }\n    }\n\n    loadMoreNews(e) {\n        if (this.state.loadedAll === true) {\n            return;\n        }\n        let url = 'http://localhost:3000/news/userId/' + Auth.getEmail() + '/pageNum/' + this.state.pageNum\n        let request = new Request(encodeURI(url), {\n            method: 'GET',\n            headers: {\n                'Authorization': 'bearer ' + Auth.getToken(),\n            },\n            cache: 'no-cache',\n        });\n        console.log(request);\n\n        fetch(request)\n            .then((res) => res.json())\n            .then((news) => {\n                if (!news || news.length === 0) {\n                    this.setState({loadedAll: true})\n                }\n                this.setState({\n                    news: this.state.news? this.state.news.concat(news) : news,\n                    // pageNum: this.state.pageNum + 1\n                });\n            });\n    }\n\n    renderNews() {\n        let news_list = this.state.news.map(news => {\n            return(\n                <a className='list-group-item' key={news.digest} href='#'>\n                    <NewsCard news={news} />\n                </a>\n            );\n        });\n\n        return (\n            <div className='container'>\n                <div className='list-group'>\n                    {news_list}\n                </div>\n            </div>\n        )\n    }\n\n    render() {\n        if (Auth.isUserAuthenticated()) {\n            if (this.state.news) {\n                return (\n                    <div>\n                        {this.renderNews()}\n                        {/* <div class=\"progress container\">\n                            <div class=\"indeterminate\"></div>\n                        </div> */}\n                    </div> \n                );\n            } else {\n                return (\n                    <div>\n                        <div className=\"progress\">\n                            <div className=\"indeterminate\"></div>\n                        </div>\n                    </div>\n                );\n            }\n        } else {\n            return(\n                <div className='container'>\n                    please login first\n                </div>\n            )\n        }\n    }\n}\n\nexport default NewsPanel;"]},"metadata":{},"sourceType":"module"}